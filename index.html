<!DOCTYPE html>
<html>
  <head>
    <title>Vega-Lite Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
  </head>
  <body>
    <h2>My Vega-Lite Dashboard</h2>
    <div id="vis"></div>

    <script type="text/javascript">
      const spec = {
        "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
        "data": {
          "url": "https://raw.githubusercontent.com/Priyanka-1731/Assignment/main/HW_III%20-%20SalesOrders.csv",
          "format": {"type": "csv"}
        },
        "vconcat": [
          {
            "hconcat": [
              {
                "mark": {"type": "arc", "innerRadius": 50},
                "encoding": {
                  "theta": {"aggregate": "sum", "field": "Total", "type": "quantitative"},
                  "color": {
                    "field": "Rep",
                    "type": "nominal",
                    "scale": {"scheme": "category20"},
                    "legend": {"title": "Rep and Item info"}
                  },
                  "tooltip": [
                    {"field": "Rep"},
                    {"aggregate": "sum", "field": "Total", "type": "quantitative", "title": "Total Sales"}
                  ]
                },
                "title": "Donut Chart: Total Sales by Rep"
              },
              {
                "mark": "circle",
                "params": [{"name": "brush", "select": {"type": "interval"}}],
                "encoding": {
                  "x": {"field": "Units", "type": "quantitative"},
                  "y": {"field": "Unit Cost", "type": "quantitative"},
                  "color": {
                    "condition": {"param": "brush", "field": "Item", "type": "nominal"},
                    "value": "lightgray"
                  },
                  "tooltip": [
                    {"field": "Item"},
                    {"field": "Units"},
                    {"field": "Unit Cost"}
                  ]
                },
                "title": "Correlation Between Units and Unit Cost (with Brush)"
              }
            ]
          },
          {
            "hconcat": [
              {
                "description": "Streamgraph of total sales over time by item",
                "data": {
                  "url": "https://raw.githubusercontent.com/Priyanka-1731/Assignment/main/HW_III%20-%20SalesOrders.csv",
                  "format": {"type": "csv"}
                },
                "transform": [
                  {"calculate": "toDate(datum.OrderDate)", "as": "OrderDateParsed"},
                  {"timeUnit": "yearmonth", "field": "OrderDateParsed", "as": "Month"},
                  {"aggregate": [{"op": "sum", "field": "Total", "as": "TotalSales"}], "groupby": ["Month", "Item"]}
                ],
                "mark": "area",
                "encoding": {
                  "x": {"timeUnit": "yearmonth", "field": "Month", "type": "temporal", "axis": {"title": "Month"}},
                  "y": {"field": "TotalSales", "type": "quantitative", "stack": "center", "axis": {"title": "Total Sales"}},
                  "color": {"field": "Item", "type": "nominal", "legend": {"title": "Rep and Item info"}},
                  "tooltip": [
                    {"field": "Item"},
                    {"field": "TotalSales", "title": "Total Sales"}
                  ]
                },
                "title": "Streamgraph: Variation of Total Sales Over Time by Item"
              },
              {
                "layer": [
                  {
                    "mark": "bar",
                    "encoding": {
                      "x": {"field": "Units", "type": "quantitative", "bin": true, "title": "Units"},
                      "y": {"aggregate": "count", "type": "quantitative", "title": "Frequency"}
                    }
                  },
                  {
                    "transform": [{"aggregate": [{"op": "mean", "field": "Units", "as": "mean_units"}]}],
                    "mark": {"type": "rule", "color": "red", "size": 2},
                    "encoding": {"x": {"field": "mean_units", "type": "quantitative"}}
                  }
                ],
                "title": "Histogram of Units with Global Mean"
              }
            ]
          },
          {
            "hconcat": [
              {
                "title": "Sales Performance by Region and Item",
                "data": {
                  "url": "https://raw.githubusercontent.com/Priyanka-1731/Assignment/main/HW_III%20-%20SalesOrders.csv",
                  "format": {"type": "csv"}
                },
                "mark": "bar",
                "encoding": {
                  "y": {"field": "Region", "type": "nominal", "title": "Region"},
                  "x": {"aggregate": "sum", "field": "Total", "type": "quantitative", "title": "Total Sales"},
                  "color": {
                    "field": "Item",
                    "type": "nominal",
                    "title": "Product Items",
                    "legend": {"title": "Rep and Item info", "labelFontSize": 12, "labelLimit": 200, "titleFontSize": 14}
                  },
                  "tooltip": [
                    {"field": "Region"},
                    {"field": "Item"},
                    {"aggregate": "sum", "field": "Total", "title": "Total Sales"}
                  ]
                }
              },
              {
                "mark": "bar",
                "encoding": {
                  "x": {"aggregate": "sum", "field": "Total", "type": "quantitative", "title": "Total Sales"},
                  "y": {"field": "Item", "type": "nominal", "title": "Product Item"},
                  "tooltip": [
                    {"field": "Item", "title": "Product Item"},
                    {"aggregate": "sum", "field": "Total", "title": "Total Sales"}
                  ]
                },
                "title": "Total Sales by Product Category"
              }
            ]
          }
        ]
      };

      vegaEmbed('#vis', spec).catch(console.error);
    </script>
  </body>
</html>
